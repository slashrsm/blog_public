<?xml version="1.0" encoding="utf-8"?>
<rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:foaf="http://xmlns.com/foaf/0.1/" xmlns:og="http://ogp.me/ns#" xmlns:rdfs="http://www.w3.org/2000/01/rdf-schema#" xmlns:schema="http://schema.org/" xmlns:sioc="http://rdfs.org/sioc/ns#" xmlns:sioct="http://rdfs.org/sioc/types#" xmlns:skos="http://www.w3.org/2004/02/skos/core#" xmlns:xsd="http://www.w3.org/2001/XMLSchema#" version="2.0" xml:base="https://janezurevc.name/">
  <channel>
    <title>Docker</title>
    <link>https://janezurevc.name/</link>
    <description/>
    <language>en</language>
    
    <item>
  <title>Drupal 8.2.0 and composer wonderland</title>
  <link>https://janezurevc.name/drupal-820-and-composer-wonderland</link>
  <description>
&lt;span&gt;Drupal 8.2.0 and composer wonderland&lt;/span&gt;

&lt;span&gt;&lt;span lang="" about="https://janezurevc.name/users/slashrsm" typeof="schema:Person" property="schema:name" datatype="" xml:lang=""&gt;slashrsm&lt;/span&gt;&lt;/span&gt;

&lt;span&gt;Mon, 17.10.2016 - 10:22&lt;/span&gt;

            &lt;div class="field field--name-body field--type-text-with-summary field--label-hidden field--item"&gt;&lt;p&gt;Over the weekend I took some time to update this site to the latest and greatest Drupal. Update itself was pretty straightforward and it went without any problems (great work Drupal community!).&lt;/p&gt;

&lt;p&gt;More interesting part was something that I wanted to do for a while. Until now I was using old-school approach repo with all modules and other dependencies committed in it. Most of you probably already heard about the &lt;a href="http://getcomposer.org"&gt;Composer&lt;/a&gt;. Thanks to &lt;a href="https://www.drupal.org/user/254778"&gt;Florian Weber (@webflo)&lt;/a&gt; and other contributors it is now fairly easy to manage your Drupal projects with it. There is a &lt;a href="https://github.com/drupal-composer/drupal-project"&gt;Composer template for Drupal projects&lt;/a&gt; available which will give you everything you need to get started. It took me just a good hour to fully convert my project (I am no Composer expert). I found this approach very nice and convenient and will be using it for all my future projects.&lt;/p&gt;

&lt;p&gt;As part of this I also worked on a &lt;a href="https://github.com/drupal-docker/nginx/pull/13"&gt;pull request&lt;/a&gt; for &lt;a href="https://hub.docker.com/u/drupaldocker/"&gt;Drupal docker&lt;/a&gt; project that makes docroot location configurable, which is a requirement for Composer driven projects.&lt;/p&gt;
&lt;/div&gt;
      
  &lt;div class="field field--name-field-related field--type-entity-reference field--label-above"&gt;
    &lt;div class="field--label"&gt;Enjoyed this post? There is more!&lt;/div&gt;
          &lt;div class="field--items"&gt;
              &lt;div class="field--item"&gt;&lt;a href="https://janezurevc.name/drupal-dev-environment-on-docker" hreflang="en"&gt;Drupal dev environment on Docker&lt;/a&gt;&lt;/div&gt;
          &lt;div class="field--item"&gt;&lt;a href="https://janezurevc.name/janezurevc-name-runs-on-drupal-8" hreflang="en"&gt;janezurevc.name runs on Drupal 8!&lt;/a&gt;&lt;/div&gt;
          &lt;div class="field--item"&gt;&lt;a href="https://janezurevc.name/call-for-drupal-8-media-ecosystem-co-maintainers" hreflang="en"&gt;Call for Drupal 8 media ecosystem co-maintainers&lt;/a&gt;&lt;/div&gt;
              &lt;/div&gt;
      &lt;/div&gt;
</description>
  <pubDate>Mon, 17 Oct 2016 08:22:28 +0000</pubDate>
    <dc:creator>slashrsm</dc:creator>
    <guid isPermaLink="false">102 at https://janezurevc.name</guid>
    </item>
<item>
  <title>Drupal dev environment on Docker</title>
  <link>https://janezurevc.name/drupal-dev-environment-on-docker</link>
  <description>
&lt;span&gt;Drupal dev environment on Docker&lt;/span&gt;

&lt;span&gt;&lt;span lang="" about="https://janezurevc.name/users/slashrsm" typeof="schema:Person" property="schema:name" datatype="" xml:lang=""&gt;slashrsm&lt;/span&gt;&lt;/span&gt;

&lt;span&gt;Thu, 06.10.2016 - 00:50&lt;/span&gt;

            &lt;div class="field field--name-body field--type-text-with-summary field--label-hidden field--item"&gt;&lt;p&gt;I've been using a Docker based development environment for about a year. The purpose of this post is to document how I do it and hopefully get some feedback from other Docker users.&lt;/p&gt;

&lt;p&gt;I will update  this post as I evolve my approach and learn better ways of doing things.&lt;/p&gt;

&lt;h2&gt;Why would anyone do that?&lt;/h2&gt;

&lt;p&gt;Modern web applications can become very complex. Days when LAMP was enough to run them are a distant past. Nowadays we need much more; &lt;a href="https://lucene.apache.org/solr/"&gt;Apache Solr&lt;/a&gt; for running search, &lt;a href="http://www.memcached.org/"&gt;Memcached&lt;/a&gt; or &lt;a href="http://redis.io"&gt;Redis&lt;/a&gt; as a fast cache storage backend, reverse proxies like &lt;a href="https://www.varnish-cache.org/"&gt;Varnish&lt;/a&gt; and more. In order to make the development as similar as possible to the production environments we need most of those services. Installing all this services to the developer's workstation can be complicated and can eat a lot of resources. Docker solves both problems by allowing you to clearly describe your stack and share this definition among your team members. It also allows you to easily start and stop the entire stack with one command, which means that your services only run when you really need them.&lt;/p&gt;

&lt;p&gt;There is more... Ever needed to test your app on a different PHP version and tried to run two different versions of PHP in parallel? With docker you simply download the images that you need and change the one that is being used with a trivial change in your definition file.&lt;/p&gt;

&lt;p&gt;Ever wanted to try a new software, but you didn't want to install a ton of dependencies on your machine? With Docker you don't need to do that. Simply download an image from &lt;a href="https://hub.docker.com/"&gt;Docker Hub&lt;/a&gt;, give it a try and remove it when you don't need it any more.&lt;/p&gt;

&lt;h2&gt;Images&lt;/h2&gt;

&lt;p&gt;I am mostly relying on &lt;a href="http://www.drupaldocker.org/"&gt;Drupal Docker&lt;/a&gt; images, which are maintained by &lt;a href="https://github.com/zaporylie"&gt;Jakub Piasecki&lt;/a&gt; (big thanks!) with the help of other members of the community. 
Its goal is to provide Drupal-tailored set of images that will help anyone to get started quickly and save a lot of time building custom ones. There are of course a &lt;a href="https://hub.docker.com/r/drupaldocker/php/"&gt;PHP&lt;/a&gt; and &lt;a href="https://hub.docker.com/r/drupaldocker/drush/"&gt;Drush&lt;/a&gt; images, but there is more. You will find a &lt;a href="https://hub.docker.com/r/drupaldocker/nginx/"&gt;Nginx&lt;/a&gt;, &lt;a href="https://hub.docker.com/r/drupaldocker/mysql/"&gt;MySQL&lt;/a&gt; and &lt;a href="https://hub.docker.com/r/drupaldocker/mariadb/"&gt;MariaDB&lt;/a&gt; images with default configuration suitable for Drupal projects.&lt;/p&gt;

&lt;p&gt;Besides Drupal Docker I use the default &lt;a href="http://redis.io/"&gt;Redis&lt;/a&gt; image and &lt;a href="https://hub.docker.com/r/wernight/phantomjs/"&gt;PhantomJS&lt;/a&gt;, which is needed to run some types of tests.&lt;/p&gt;

&lt;h2&gt;Bringing it all together&lt;/h2&gt;

&lt;p&gt;Every project needs multiple containers to function properly. I am using &lt;a href="https://docs.docker.com/compose/"&gt;Docker compose&lt;/a&gt; to describe environment for every Drupal project I work on. Drupal compose is a tool tool that allows you to describe docker containers that you need and links between them. This is my standard &lt;em&gt;docker-compose.yml&lt;/em&gt; file, which lives in the root of a given Drupal project:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;maria:
  image: drupaldocker/mariadb:10
  environment:
    MYSQL_ALLOW_EMPTY_PASSWORD: 'True'
    MYSQL_DATABASE: drupal
  ports:
    - 3306

web:
  image: drupaldocker/nginx:1
  ports:
    - 80
  volumes_from:
    - php
  links:
    - php

php:
  image: drupaldocker/php-dev:7
  links:
    - maria
  volumes:
    - ./docroot:/var/www/html

drush:
  image: drupaldocker/drush:8
  links:
    - maria
    - web
    - phantomjs
  volumes_from:
    - php

solr:
  image: solr:5.5-alpine
  ports:
    - 8983
  volumes:
    - ./modules/search_api_solr/solr-conf/5.x:/solr-conf/conf
  entrypoint:
    - docker-entrypoint.sh
    - solr-precreate
    - d8
    - /solr-conf

redis:
  image: redis:3-alpine

phantomjs:
  image: wernight/phantomjs:2
  volumes_from:
    - php
  links:
    - web
  entrypoint: phantomjs
  command: "--ssl-protocol=any --ignore-ssl-errors=true /var/www/html/vendor/jcalderonzumba/gastonjs/src/Client/main.js 8510 1024 768"

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;One thing that experienced Docker users will notice is the fact that I do not include Drupal codebase in the PHP image. I prefer to check it out on my local machine and mount it into the running container. This allows me to use IDE that is installed on the host machine while still being able to run my Drupal applications inside containers.&lt;/p&gt;

&lt;p&gt;With the compose file in place I can now control my environment from anywhere inside the checkout with a few simple commands:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# To bring the environment up.
docker-compose up -d

# To stop it.
docker-compose stop

# To remove all containers (and their data).
docker-compose rm

# To see the status of all running containers.
docker-compose ps

&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This approach works quite well, but I am aware that is not perfect. It would be very interesting to hear how others approach this (check the comments section below!).&lt;/p&gt;

&lt;h2&gt;Drush&lt;/h2&gt;

&lt;p&gt;Drush is a crucial part of any Drupal development workflow. I run it through a separate container, which shares volumes with the main PHP and is linked to the database container. In order to run it I do:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;docker-compose run --rm drush drush
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;This will run the &lt;em&gt;drush&lt;/em&gt; command inside &lt;em&gt;drush&lt;/em&gt; container (see definition in the compose file above) and remove the container when done. The command is a bit too long to type it into the console every time so I created an alias for it:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# To install drupal.
dcdr site-install --account-name=admin --account-pass=admin

# To enable the Entity browser module.
dcdr en entity_browser
&lt;/code&gt;&lt;/pre&gt;

&lt;h2&gt;Debugging with xdebug&lt;/h2&gt;

&lt;p&gt;It has become practically impossible to develope for Drupal without the step debugger. In order to enable this in my setup I use &lt;a href="https://hub.docker.com/r/drupaldocker/php-dev/"&gt;PHP development images&lt;/a&gt; that Drupal Docker provides and come with the &lt;a href="https://xdebug.org/"&gt;Xdebug extension&lt;/a&gt; pre-installed. Debugging http requests is as easy as enabling debugging for the requests and making sure that the IDE or text editor is listening to the incoming connections from Xdebug.&lt;/p&gt;

&lt;p&gt;It is also possible to debug drush requests by setting a few environment variables:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;docker-compose run --rm drush sudo -u root XDEBUG_CONFIG="idekey=PHPSTORM_XDEBUG remote_host=172.17.0.1" php /root/.composer/vendor/bin/drush.php
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;&lt;em&gt;PHPSTORM_XDEBUG&lt;/em&gt; is the session id that my IDE listens for and &lt;em&gt;172.17.0.1&lt;/em&gt; IP of the host machine from within the container. I have an alias for that too:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# To debug migration of users.
dcdrd migrate-import users
&lt;/code&gt;&lt;/pre&gt;

&lt;h2&gt;Running tests&lt;/h2&gt;

&lt;p&gt;I run tests through the drush container. In order to run Simpletest I have to do the following:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;docker-compose run --rm drush sudo -u www-data php ./core/scripts/run-tests.sh --color --directory modules/entity_browser
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And to run PHPUnit:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;docker-compose run --rm drush sudo -u www-data MINK_DRIVER_ARGS="[\"http:\/\/phantomjs:8510\"]" SIMPLETEST_DB="mysql://root@maria/drupal" ./vendor/bin/phpunit --verbose -c core  modules/entity_browser
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;And yes, there are aliases for those too. See the pattern? :)&lt;/p&gt;

&lt;h2&gt;Conclusion&lt;/h2&gt;

&lt;p&gt;The described approach has been working quite well so far. I like Docker and I am planning to keep using it in the future. It is clear to me that my approach probably isn't the most standard and that there are probably better ways.&lt;/p&gt;

&lt;p&gt;Exactly for that reason I'd like to hear from you. Do you believe that your solution works better? Do you like to approach things differently? Let us know in the comments section below so we'll learn together!&lt;/p&gt;
&lt;/div&gt;
      
  &lt;div class="field field--name-field-related field--type-entity-reference field--label-above"&gt;
    &lt;div class="field--label"&gt;Enjoyed this post? There is more!&lt;/div&gt;
          &lt;div class="field--items"&gt;
              &lt;div class="field--item"&gt;&lt;a href="https://janezurevc.name/janezurevc-name-runs-on-drupal-8" hreflang="en"&gt;janezurevc.name runs on Drupal 8!&lt;/a&gt;&lt;/div&gt;
          &lt;div class="field--item"&gt;&lt;a href="https://janezurevc.name/call-for-drupal-8-media-ecosystem-co-maintainers" hreflang="en"&gt;Call for Drupal 8 media ecosystem co-maintainers&lt;/a&gt;&lt;/div&gt;
          &lt;div class="field--item"&gt;&lt;a href="https://janezurevc.name/releases-of-various-drupal-8-media-modules" hreflang="en"&gt;Releases of various Drupal 8 media modules&lt;/a&gt;&lt;/div&gt;
              &lt;/div&gt;
      &lt;/div&gt;
</description>
  <pubDate>Wed, 05 Oct 2016 22:50:36 +0000</pubDate>
    <dc:creator>slashrsm</dc:creator>
    <guid isPermaLink="false">101 at https://janezurevc.name</guid>
    </item>

  </channel>
</rss>
